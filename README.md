# Сервис аутентификации на основе JWT

Этот проект реализует часть сервиса аутентификации, который генерирует и обновляет JWT токены. Сервис построен с использованием Go, Gin и PostgreSQL. Он включает два REST-эндоинта для управления токенами.

## Возможности

- Генерация пары токенов **Access** и **Refresh**.
- Безопасная валидация и обновление токенов.
- Обеспечение целостности токенов и предотвращение повторного использования Refresh токенов.
- Уведомление пользователей по email при попытке обновления токена с другого IP-адреса.
- Использование PostgreSQL для безопасного хранения хешированных Refresh токенов.

---

## Эндпоинты

### 1. Генерация токенов (`GET /access`)
- **Описание**: Выдает пару Access и Refresh токенов для пользователя.
- **Параметры запроса**:
  - `guid`: Идентификатор пользователя.
- **Ответ**:
  - HTTP 200: JSON-объект с парой токенов.
  - HTTP 400: Неверный запрос.
  - HTTP 500: Внутренняя ошибка сервера.

### 2. Обновление токенов (`POST /refresh`)
- **Описание**: Обновляет истекший Access токен с использованием действительного Refresh токена.
- **Заголовки запроса**:
  - `Cookie`: Содержит `rt` (Refresh Token) и `at` (Access Token).
- **Ответ**:
  - HTTP 200: JSON-объект с новой парой токенов.
  - HTTP 400: Неверный запрос (например, отсутствуют или некорректны cookies).
  - HTTP 500: Внутренняя ошибка сервера.

---

## Используемые технологии

- **Язык**: Go
- **Фреймворк**: Gin
- **База данных**: PostgreSQL
- **Аутентификация**:
  - Access токены: JWT (SHA512).
  - Refresh токены: Кодируются в Base64 и хранятся в виде хеша bcrypt.
- **Тесты**: testify
- **Контейнеризация**: Docker
- **Рассылка EMail**: gomail

---

### Схема БД
```SQL
CREATE TABLE users
(
   	id SERIAL PRIMARY KEY,
	email VARCHAR(255),
	guid VARCHAR(255) UNIQUE
);

CREATE TABLE tokens
(
	id SERIAL PRIMARY KEY,
	guid VARCHAR(255),
	FOREIGN KEY (guid) REFERENCES users(guid),
	iat BIGINT,
	ip VARCHAR(255),
	refresh_hash VARCHAR(255)
)
```
